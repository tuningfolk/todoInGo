<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Todo List</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f9fafb;
      --card: #ffffff;
      --accent: #6366f1;
      --text: #111827;
      --muted: #6b7280;
      --radius: 12px;
      --shadow: 0 10px 15px rgba(0, 0, 0, 0.05);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 60px 20px;
    }

    .container {
      background-color: var(--card);
      padding: 40px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 600px;
    }

    h2 {
      font-size: 28px;
      margin-bottom: 24px;
      font-weight: 600;
    }

    label {
      display: block;
      margin-top: 20px;
      font-size: 14px;
      font-weight: 500;
      color: var(--muted);
    }

    input, textarea {
      width: 100%;
      margin-top: 6px;
      padding: 14px;
      font-size: 15px;
      border: 1px solid #d1d5db;
      border-radius: var(--radius);
      background-color: #f3f4f6;
      color: var(--text);
      transition: border-color 0.2s ease;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    button {
      margin-top: 30px;
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background-color: var(--accent);
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #4f46e5;
    }

    #result {
      margin-top: 20px;
      font-size: 14px;
    }

    .success { color: #10b981; }
    .error { color: #ef4444; }

    #posts {
      margin-top: 40px;
    }

    .post {
      display: flex;
      align-items: start;
      gap: 16px;
      padding: 20px;
      background: var(--card);
      border: 1px solid #e5e7eb;
      border-radius: var(--radius);
      margin-bottom: 16px;
      transition: all 0.2s ease;
    }

    .post.completed {
      opacity: 0.5;
    }

    .post-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .post.completed .post-title {
      text-decoration: line-through;
    }

    .post-body {
      font-size: 15px;
      color: var(--muted);
    }

    .checkbox {
      appearance: none;
      background-color: #f3f4f6;
      border: 2px solid #d1d5db;
      width: 22px;
      height: 22px;
      border-radius: 6px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
      margin-top: 4px;
    }

    .checkbox:checked {
      background-color: #10b981;
      border-color: #10b981;
    }

    .checkbox:checked::after {
      content: '✓';
      color: white;
      font-size: 14px;
      position: absolute;
      top: -1px;
      left: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Create a Task</h2>
    <label for="title">Title</label>
    <input id="title" type="text" placeholder="Task title" />

    <label for="body">Description</label>
    <textarea id="body" rows="4" placeholder="Task details..."></textarea>

    <label for="user_id">User ID</label>
    <input id="user_id" type="number" placeholder="User ID" />

    <button onclick="submitPost()">Add Task</button>

    <p id="result"></p>

    <div id="posts">Loading tasks...</div>
  </div>

  <script>
    async function fetchPosts() {
      try {
        const res = await fetch("http://127.0.0.1:8080/api/posts");
        if (!res.ok) throw new Error("Fetch failed");
        const posts = await res.json();
        const container = document.getElementById("posts");
        container.innerHTML = "";
        posts.forEach(p => {
          const div = document.createElement("div");
          div.className = "post" + (p.completed ? " completed" : "");

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "checkbox";
          checkbox.checked = p.completed;
          checkbox.onclick = () => toggleCompleted(p.id, checkbox.checked, div);

          const content = document.createElement("div");
          content.innerHTML = `<div class="post-title">${p.title}</div><div class="post-body">${p.body}</div>`;

          div.appendChild(checkbox);
          div.appendChild(content);
          container.appendChild(div);
        });
      } catch (e) {
        console.error("Failed to load posts:", e);
      }
    }

    async function toggleCompleted(post_id, completed, postDiv) {
      try {
        const res = await fetch("http://127.0.0.1:8080/api/completed", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ post_id, completed })
        });

        if (!res.ok) throw new Error("Update failed");
        postDiv.classList.toggle("completed", completed);
      } catch (e) {
        alert("❌ Could not update task status.");
      }
    }

    async function submitPost() {
      const title = document.getElementById("title").value;
      const body = document.getElementById("body").value;
      const user_id = parseInt(document.getElementById("user_id").value, 10);

      const data = { title, body, user_id };

      try {
        const res = await fetch("http://127.0.0.1:8080/add/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = document.getElementById("result");
        if (res.ok) {
          result.textContent = "✅ Task added successfully!";
          result.className = "success";
          fetchPosts();
        } else {
          result.textContent = `❌ Failed: ${res.status}`;
          result.className = "error";
        }
      } catch (err) {
        document.getElementById("result").textContent = "❌ Error: " + err;
        document.getElementById("result").className = "error";
      }
    }

    window.onload = fetchPosts;
  </script>
</body>
</html>

