<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Add Post</title>
  <style>
    :root {
      --bg: #f9f9fb;
      --card: #ffffff;
      --accent: #6366f1;
      --text: #111827;
      --muted: #6b7280;
      --radius: 12px;
      --shadow: 0 4px 14px rgba(0,0,0,0.05);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 40px 20px;
    }

    .container {
      background-color: var(--card);
      padding: 32px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 500px;
    }

    h2 {
      font-size: 24px;
      margin-bottom: 20px;
      color: var(--text);
    }

    label {
      display: block;
      margin-top: 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--muted);
    }

    input, textarea {
      width: 100%;
      margin-top: 6px;
      padding: 12px;
      font-size: 15px;
      border: 1px solid #d1d5db;
      border-radius: var(--radius);
      background-color: #f3f4f6;
      color: var(--text);
      transition: border-color 0.2s ease;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    button {
      margin-top: 24px;
      width: 100%;
      padding: 12px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background-color: var(--accent);
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #4f46e5;
    }

    #result {
      margin-top: 16px;
      font-size: 14px;
    }

    .success {
      color: #10b981;
    }

    .error {
      color: #ef4444;
    }

    #posts {
      margin-top: 40px;
    }

    .post {
      padding: 16px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .post.completed{
	    opacity: 0.6;
    }

    .post h3 {
      margin-bottom: 4px;
      font-size: 18px;
      color: var(--text);
    }

    .post.completed h3{
	    text-decoration: line-through;
    }

    .post-content{
	    flex-grow: 1;
    }	
/*
    .post p {
      color: var(--muted);
      font-size: 15px;
    }
*/
	.checkmark-btn{
		appearance: none,
		background-color: #f3f4f6;
		border: 2px solid #d1d5db;
		width: 24px;
		height: 24px;
		border-radius: 6px;
		position: relative;
		cursor: pointer;
		transition: all 0.2s ease;
		flex-shrink: 0;
	}
	.checkmark-btn:checked{
		background-color: #10b981;
		border-color: #10b981;
	}

	.checkmark-btn:checked:after{
		content: '✓';
		color: white;
		font-size: 14px;
		position: absolute;
		left: 5px;
		top: -1px;
	}


  </style>
</head>
<body>
  <div class="container">
    <h2>Create a Post</h2>

    <label for="title">Title</label>
    <input id="title" type="text" placeholder="Post title" />

    <label for="body">Body</label>
    <textarea id="body" rows="4" placeholder="Post body"></textarea>

    <label for="user_id">User ID</label>
    <input id="user_id" type="number" placeholder="User ID" />

    <button onclick="submitPost()">Submit</button>

    <p id="result"></p>

    <div id="posts">Loading posts...</div>
  </div>

  <script>
    async function fetchPosts() {
      try {
        const res = await fetch("http://127.0.0.1:8080/api/posts");
        if (!res.ok) throw new Error("Fetch failed");
        const posts = await res.json();
        const container = document.getElementById("posts");
        container.innerHTML = ""; // Clear existing
        posts.forEach(p => {
          const div = document.createElement("div");
          div.className = "post" + (p.completed ? " completed" : "");
          
	  
	  const contentDiv = document.createElement("div");
	  contentDiv.className = "post-content";
		contentDiv.innerHTML = `<h3>${p.post_id}${p.title}</h3><p>${p.body}</p>`;
          const checkbox = document.createElement("input");
	  checkbox.type = "checkbox";
	  checkbox.className = "checkmark-btn";
	  checkbox.checked = p.completed;
	  checkbox.onclick = () => toggleCompleted(p.post_id, checkbox.checked, div);
	  
	  div.appendChild(checkbox);
	  div.appendChild(contentDiv);
	  container.appendChild(div);
        });
      } catch (e) {
        console.error("Failed to load posts:", e);
      }
    }

    async function toggleCompleted(post_id, completed, postDiv){
	    try{
		    const res = await fetch("http://127.0.0.1:8080/api/completed/", {
			    method: "POST",
			    headers: {"Content-Type": "application/json"},
			    body: JSON.stringify({ post_id, completed })
		    });

		    if(!res.ok){
			    throw new Error("failed to update completion");
		    }

		    if(completed){
			    postDiv.classList.add("completed")
		    }else{
			    postDiv.classList.remove("completed")
		    }
	    }catch(err){
		    console.error("error updating completion from client:", err);
		    alert("❌ Couldn't update completion status.");
	    }
	    }
    async function submitPost() {
      const title = document.getElementById("title").value;
      const body = document.getElementById("body").value;
      const user_id = parseInt(document.getElementById("user_id").value, 10);
      const data = { title, body, user_id };

      try {
        const res = await fetch("http://127.0.0.1:8080/api/add/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = document.getElementById("result");
        if (res.ok) {
          result.textContent = "✅ Post submitted successfully!";
          result.className = "success";
          fetchPosts();
        } else {
          result.textContent = `❌ Failed: ${res.status}`;
          result.className = "error";
        }
      } catch (err) {
        const result = document.getElementById("result");
        result.textContent = "❌ Error: " + err.message;
        result.className = "error";
      }
    }

    window.onload = fetchPosts;
  </script>
</body>
</html>

